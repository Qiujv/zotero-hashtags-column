<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Special Tags Column Options</title>
<script src="chrome://zotero/content/include.js"></script>
<style>
  body { font-family: system-ui; margin: 1em; }
  textarea { width: 100%; height: 200px; }
</style>
</head>
<body>
  <h1>Special Tags</h1>
  <p>每行一个 tag，或粘贴 JSON 映射：</p>
  <textarea id="input"></textarea>
  <button id="save">保存</button>

  <script>
    const PREF_KEY = "extensions.special-tags-column.prefs";
    const input = document.getElementById("input");

    // 初始化
    const prefs = JSON.parse(Zotero.Prefs.get(PREF_KEY) || "{}");
    input.value = prefs.raw || "";

    // 保存
    document.getElementById("save").addEventListener("click", () => {
      const raw = input.value.trim();
      let mapping = {};
      let specialList = [];

      try {
        mapping = JSON.parse(raw);   // 如果是 JSON
      } catch (_) {
        specialList = raw.split(/[\r\n]+/).filter(Boolean); // 按行
      }

      const newPrefs = { raw, mapping, specialList };
      Zotero.Prefs.set(PREF_KEY, JSON.stringify(newPrefs));
      Zotero.ItemTreeManager.refreshColumns();
    });
  </script>
</body>
</html>